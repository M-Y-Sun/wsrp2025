(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Wolfram 14.2' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       154,          7]
NotebookDataLength[     31550,        658]
NotebookOptionsPosition[     29824,        628]
NotebookOutlinePosition[     30216,        644]
CellTagsIndexPosition[     30173,        641]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"transform", "[", 
   RowBox[{"reachable_List", ",", "key_List"}], "]"}], ":=", 
  "\[IndentingNewLine]", 
  RowBox[{"Flatten", "@", "\[IndentingNewLine]", 
   RowBox[{"Table", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"If", "[", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"MemberQ", "[", 
        RowBox[{"reachable", ",", "j"}], "]"}], ",", "\[IndentingNewLine]", 
       RowBox[{"Flatten", "@", 
        RowBox[{"key", "[", 
         RowBox[{"[", 
          RowBox[{
           RowBox[{
            RowBox[{"8", "*", "j"}], "-", "7"}], ";;", 
           RowBox[{"8", "*", "j"}]}], "]"}], "]"}]}], ",", 
       "\[IndentingNewLine]", 
       RowBox[{"Table", "[", 
        RowBox[{"1", ",", "8"}], "]"}]}], "\[IndentingNewLine]", "]"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"j", ",", "states"}], "}"}]}], "\[IndentingNewLine]", 
    "]"}]}]}]], "Input",
 CellChangeTimes->{{3.960940006819491*^9, 3.960940064821398*^9}, {
  3.960980432910825*^9, 3.960980440529163*^9}},
 CellLabel->
  "In[335]:=",ExpressionUUID->"782c6a84-4144-43de-8545-bb1e2ca399a1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ctransform", "=", 
   RowBox[{"Compile", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"reachable", ",", "_Integer", ",", "1"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"key", ",", "_Integer", ",", "1"}], "}"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Flatten", "@", "\[IndentingNewLine]", 
      RowBox[{"Table", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"If", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"MemberQ", "[", 
           RowBox[{"reachable", ",", "j"}], "]"}], ",", "\[IndentingNewLine]", 
          RowBox[{"Flatten", "@", 
           RowBox[{"key", "[", 
            RowBox[{"[", 
             RowBox[{
              RowBox[{
               RowBox[{"6", "*", "j"}], "-", "5"}], ";;", 
              RowBox[{"6", "*", "j"}]}], "]"}], "]"}]}], ",", 
          "\[IndentingNewLine]", 
          RowBox[{"Table", "[", 
           RowBox[{"1", ",", "6"}], "]"}]}], "\[IndentingNewLine]", "]"}], ",",
         "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"j", ",", "states"}], "}"}]}], "\[IndentingNewLine]", 
       "]"}]}], ",", "\[IndentingNewLine]", 
     RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"RuntimeOptions", "->", "\"\<Speed\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"RuntimeAttributes", "->", 
      RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.9607121826855593`*^9, 3.960712336493713*^9}, {
   3.960712383528637*^9, 3.9607123894619627`*^9}, {3.960712626304348*^9, 
   3.9607126263837843`*^9}, 3.960712678395905*^9, {3.960712989924905*^9, 
   3.960712998123481*^9}, 3.96085643491775*^9, {3.96085646712996*^9, 
   3.960856476992923*^9}, {3.9608850239340973`*^9, 3.960885028407645*^9}, 
   3.960903747786063*^9, {3.9609361643614893`*^9, 3.96093616489165*^9}, {
   3.960937108242236*^9, 3.960937109524105*^9}, {3.960937594317563*^9, 
   3.960937594896133*^9}, {3.960937627961693*^9, 3.96093763919237*^9}, {
   3.960938741405939*^9, 3.960938741862596*^9}, {3.960938779518962*^9, 
   3.960938780044948*^9}, {3.960980862309011*^9, 3.960980882705894*^9}, 
   3.960981034813834*^9, {3.960994364094099*^9, 3.960994373835772*^9}, {
   3.9610035691128197`*^9, 3.9610035724169188`*^9}},
 CellLabel->"In[25]:=",ExpressionUUID->"141819c5-efcd-4271-96e3-cb5ba28ba90c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cloop", "=", 
   RowBox[{"Compile", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"len", ",", "_Integer"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"reach", ",", "_Integer", ",", "2"}], "}"}], ",", 
       RowBox[{"{", 
        RowBox[{"info", ",", "_Integer", ",", "3"}], "}"}]}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"Module", "[", 
      RowBox[{
       RowBox[{"{", 
        RowBox[{"i", ",", "tmp"}], "}"}], ",", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"For", "[", "\[IndentingNewLine]", 
         RowBox[{
          RowBox[{"i", "=", "1"}], ",", "\[IndentingNewLine]", 
          RowBox[{"i", "<=", "len"}], ",", "\[IndentingNewLine]", 
          RowBox[{"i", "++"}], ",", "\[IndentingNewLine]", 
          RowBox[{"With", "[", 
           RowBox[{
            RowBox[{"{", 
             RowBox[{"rcur", "=", 
              RowBox[{"reach", "[", 
               RowBox[{"[", 
                RowBox[{"i", ",", 
                 RowBox[{
                  RowBox[{"-", 
                   RowBox[{"reach", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}]}], ";;", 
                  RowBox[{"-", "1"}]}]}], "]"}], "]"}]}], "}"}], ",", 
            "\[IndentingNewLine]", 
            RowBox[{
             RowBox[{"map", "[", "\[IndentingNewLine]", 
              RowBox[{"\"\<Insert\>\"", ",", "\[IndentingNewLine]", 
               RowBox[{
                RowBox[{
                 RowBox[{"(", 
                  RowBox[{"#", "->", 
                   RowBox[{"(", 
                    RowBox[{
                    RowBox[{"map", "[", 
                    RowBox[{"\"\<Lookup\>\"", ",", "#", ",", 
                    RowBox[{"0", "&"}]}], "]"}], "\[IndentingNewLine]", "+", 
                    RowBox[{"If", "[", "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"consQ", "[", "rcur", "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"tmp", "=", 
                    RowBox[{"perm", "[", 
                    RowBox[{"reach", "[", 
                    RowBox[{"[", 
                    RowBox[{"i", ",", "1"}], "]"}], "]"}], "]"}]}], ";", 
                    RowBox[{"i", "+=", 
                    RowBox[{"tmp", "-", "1"}]}], ";", "tmp"}], ",", 
                    "\[IndentingNewLine]", "1"}], "\[IndentingNewLine]", 
                    "]"}]}], ")"}]}], "\[IndentingNewLine]", ")"}], "&"}], "@", 
                RowBox[{"ctransform", "[", 
                 RowBox[{"rcur", ",", 
                  RowBox[{"Flatten", "@", 
                   RowBox[{"info", "[", 
                    RowBox[{"[", "i", "]"}], "]"}]}]}], "]"}]}]}], 
              "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
           "]"}]}], "\[IndentingNewLine]", "]"}], ";"}]}], 
      "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
     RowBox[{"{", 
      RowBox[{"{", 
       RowBox[{
        RowBox[{"consQ", "[", "_", "]"}], ",", 
        RowBox[{"True", "|", "False"}]}], "}"}], "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"CompilationTarget", "->", "\"\<C\>\""}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"RuntimeAttributes", "->", 
      RowBox[{"{", "Listable", "}"}]}]}], "\[IndentingNewLine]", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.9609406986862297`*^9, 3.960940725329445*^9}, {
   3.960940756701955*^9, 3.9609407569329023`*^9}, {3.960940880072145*^9, 
   3.960940914673758*^9}, {3.960941037804978*^9, 3.9609410458750353`*^9}, {
   3.960941092147488*^9, 3.9609411074454823`*^9}, {3.960941142998816*^9, 
   3.960941202653871*^9}, {3.960941256546919*^9, 3.960941324652543*^9}, {
   3.960941356794736*^9, 3.960941401496449*^9}, 3.960941544267942*^9, {
   3.960941645744815*^9, 3.960941744187131*^9}, {3.960941899810133*^9, 
   3.9609419000368567`*^9}, {3.9609420622559967`*^9, 3.96094209086874*^9}, {
   3.9609422813385067`*^9, 3.960942354744182*^9}, {3.960942481375559*^9, 
   3.960942484362759*^9}, {3.960942621127902*^9, 3.960942661323242*^9}, {
   3.9609427327199697`*^9, 3.960942794547517*^9}, {3.960942969079525*^9, 
   3.9609430180112677`*^9}, {3.9609431121795073`*^9, 3.960943113990733*^9}, {
   3.96094316870396*^9, 3.960943171225945*^9}, {3.96094324513104*^9, 
   3.9609435100105658`*^9}, {3.960943542879734*^9, 3.9609436095250607`*^9}, {
   3.960943654282618*^9, 3.960943874811152*^9}, {3.9609439147711363`*^9, 
   3.9609439378858767`*^9}, {3.960943996515499*^9, 3.9609440508277082`*^9}, {
   3.960976495756897*^9, 3.960976653899335*^9}, {3.96097669693491*^9, 
   3.960976721454265*^9}, {3.9609767762171307`*^9, 3.960976776831603*^9}, {
   3.960976816379684*^9, 3.9609768168489637`*^9}, 3.960980892767447*^9},
 CellLabel->
  "In[435]:=",ExpressionUUID->"44e29823-3957-4523-9c39-615e39118214"],

Cell["Get full rule form for each rule number:", "CodeText",
 CellChangeTimes->{{3.9609353320661707`*^9, 3.960935369918008*^9}, {
  3.960984843783874*^9, 
  3.960984850438045*^9}},ExpressionUUID->"20ed4f37-290d-4dbe-b16c-\
5196f07af612"],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{"(", 
    RowBox[{"2", "*", "states", "*", "symbols"}], ")"}], "^", 
   RowBox[{"(", 
    RowBox[{"states", "*", "symbols"}], ")"}]}], ";"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{"rules", "=", 
   RowBox[{"ParallelMap", "[", 
    RowBox[{
     RowBox[{
      RowBox[{"tmRuleFromNum", "[", 
       RowBox[{"#", ",", "states", ",", "symbols"}], "]"}], "&"}], ",", 
     RowBox[{"Range", "[", 
      RowBox[{"0", ",", 
       RowBox[{"%", "-", "1"}]}], "]"}]}], "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.960935304897623*^9, 3.9609353257001953`*^9}, {
  3.960935392513049*^9, 3.960935411768487*^9}, {3.960935655393321*^9, 
  3.960935655747974*^9}},
 CellLabel->"In[19]:=",ExpressionUUID->"9a1bf6a4-57df-4ff5-bdcc-88440ac92918"],

Cell[BoxData[
 RowBox[{
  RowBox[{"rules", "=", 
   RowBox[{"Import", "[", "\"\<./wsrp/project/main/mx/rules.mx\>\"", "]"}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.9609725559488487`*^9, 3.960972571245792*^9}, 
   3.9609727983705273`*^9},
 CellLabel->"In[14]:=",ExpressionUUID->"73aa3840-b032-406d-ad89-a95f87708b13"],

Cell[CellGroupData[{

Cell["Rule Extraction", "Subsection",
 CellChangeTimes->{{3.960973108458926*^9, 
  3.960973123706935*^9}},ExpressionUUID->"d24af7cb-9903-45dc-8a3a-\
5473e59453df"],

Cell["Number of times each rule repeats:", "CodeText",
 CellChangeTimes->{{3.960973149845223*^9, 
  3.960973154932057*^9}},ExpressionUUID->"cb5924c7-d200-4225-a42b-\
3043f7b3feb1"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ruleRepeats", ":=", 
   RowBox[{"elems", "[", 
    RowBox[{"[", 
     RowBox[{"All", ",", "2"}], "]"}], "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.960770183234651*^9, 3.960770196660256*^9}, {
   3.960842878443836*^9, 3.960842912402746*^9}, 3.960989679452058*^9},
 CellLabel->
  "In[474]:=",ExpressionUUID->"806871b6-330b-4543-8105-7f9806e31941"],

Cell[BoxData[
 RowBox[{
  RowBox[{"fullRules", "=", 
   RowBox[{"With", "[", "\[IndentingNewLine]", 
    RowBox[{
     RowBox[{"{", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"key", "=", 
        RowBox[{"Transpose", "@", 
         RowBox[{"{", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"Riffle", "[", 
            RowBox[{
             RowBox[{"Range", "[", "states", "]"}], ",", 
             RowBox[{"Range", "[", "states", "]"}]}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Table", "[", 
            RowBox[{
             RowBox[{"BitAnd", "[", 
              RowBox[{"i", ",", "1"}], "]"}], ",", 
             RowBox[{"{", 
              RowBox[{"i", ",", 
               RowBox[{"states", "*", "symbols"}]}], "}"}]}], "]"}]}], 
          "\[IndentingNewLine]", "}"}]}]}], ",", "\[IndentingNewLine]", 
       RowBox[{"vals", "=", 
        RowBox[{
         RowBox[{
          RowBox[{"Partition", "[", 
           RowBox[{
            RowBox[{"#", "[", 
             RowBox[{"[", "1", "]"}], "]"}], ",", "3"}], "]"}], "&"}], "/@", 
         "elems"}]}]}], "\[IndentingNewLine]", "}"}], ",", 
     "\[IndentingNewLine]", 
     RowBox[{"ParallelMap", "[", 
      RowBox[{
       RowBox[{
        RowBox[{"Table", "[", 
         RowBox[{
          RowBox[{
           RowBox[{"key", "[", 
            RowBox[{"[", "i", "]"}], "]"}], "->", 
           RowBox[{"#", "[", 
            RowBox[{"[", "i", "]"}], "]"}]}], ",", 
          RowBox[{"{", 
           RowBox[{"i", ",", 
            RowBox[{"states", "*", "symbols"}]}], "}"}]}], "]"}], "&"}], ",", 
       "vals"}], "]"}]}], "\[IndentingNewLine]", "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.960730716101252*^9, 3.960730758504407*^9}, {
   3.9607308739197187`*^9, 3.9607309359911537`*^9}, {3.960730969932693*^9, 
   3.960731293383328*^9}, {3.9607313529652853`*^9, 3.960731353084798*^9}, {
   3.960731388750389*^9, 3.9607314171299267`*^9}, {3.960761716237268*^9, 
   3.960761725402378*^9}, {3.960769825301092*^9, 3.960769835766761*^9}, {
   3.9607701055352077`*^9, 3.960770107925642*^9}, {3.960770191020232*^9, 
   3.960770192086849*^9}, {3.960842935668283*^9, 3.960842968322817*^9}, {
   3.960843007704619*^9, 3.960843011541641*^9}, 3.960843451233185*^9, {
   3.960844925754219*^9, 3.960844926667222*^9}, {3.960844972490961*^9, 
   3.96084507154851*^9}, {3.960884300433853*^9, 3.960884301756439*^9}, {
   3.960973170025258*^9, 3.960973180787694*^9}, {3.960973218998685*^9, 
   3.9609732233618727`*^9}, {3.960988889211059*^9, 3.960988889833274*^9}},
 CellLabel->
  "In[475]:=",ExpressionUUID->"7899d09b-674f-4e64-a386-c18a41ba101c"],

Cell[BoxData[
 RowBox[{
  RowBox[{"ruleNumsCompressed", "=", 
   RowBox[{
    RowBox[{"ResourceFunction", "[", "\"\<MonitorProgress\>\"", "]"}], "@", 
    RowBox[{"Map", "[", 
     RowBox[{
      RowBox[{
       RowBox[{
        RowBox[{"tmRuleToNum", "[", "#", "]"}], "[", 
        RowBox[{"[", "1", "]"}], "]"}], "&"}], ",", "fullRules"}], "]"}]}]}], 
  ";"}]], "Input",
 CellChangeTimes->{{3.96097324841885*^9, 3.96097327893099*^9}, {
   3.960973318798622*^9, 3.960973323324163*^9}, {3.960973522865045*^9, 
   3.960973530378345*^9}, 3.960973571971382*^9, {3.960989786774136*^9, 
   3.960989788198845*^9}, {3.960989835320126*^9, 3.960989858241928*^9}},
 CellLabel->
  "In[478]:=",ExpressionUUID->"1f89bb2a-10ff-4b2c-abf4-7374059aa311"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"\"\<./wsrp/project/main/full_rules.mx\>\"", ",", "fullRules", 
    ",", "\"\<MX\>\""}], "]"}], ";"}], "\n", 
 RowBox[{
  RowBox[{"Export", "[", 
   RowBox[{"\"\<./wsrp/project/main/rule_nums_compressed.mx\>\"", ",", 
    "fullRules", ",", "\"\<MX\>\""}], "]"}], ";"}]}], "Input",
 CellChangeTimes->{{3.9609735339112177`*^9, 3.960973544251225*^9}, 
   3.960973659623045*^9, {3.9609737917754087`*^9, 3.960973796648947*^9}, {
   3.960989793175611*^9, 
   3.960989816271402*^9}},ExpressionUUID->"205f85cf-13ee-4933-86e5-\
5b2a91f3a602"],

Cell[BoxData[{
 RowBox[{
  RowBox[{"fullRules", "=", 
   RowBox[{
   "Import", "[", "\"\<./wsrp/project/main/mx/full_rules.mx\>\"", "]"}]}], 
  ";"}], "\n", 
 RowBox[{
  RowBox[{"ruleNumsCompressed", "=", 
   RowBox[{
   "Import", "[", "\"\<./wsrp/project/main/mx/rule_nums_compressed.mx\>\"", 
    "]"}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.9609735339112177`*^9, 3.960973544251225*^9}, 
   3.960973659623045*^9, {3.9609737917754087`*^9, 3.960973796648947*^9}, 
   3.960989822141756*^9},ExpressionUUID->"3b144d34-25ab-49d7-b80a-\
7d60fca8128f"],

Cell[BoxData[
 RowBox[{
  RowBox[{"cftransform", "=", 
   RowBox[{"FunctionCompile", "[", "\[IndentingNewLine]", 
    RowBox[{"Function", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"{", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Typed", "[", 
         RowBox[{"states", ",", "\"\<MachineInteger\>\""}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"Typed", "[", 
         RowBox[{"reachable", ",", 
          
          RowBox[{"\"\<FixedArray\>\"", "::[", "\"\<MachineInteger\>\"", 
           "]"}]}], "]"}], ",", "\[IndentingNewLine]", 
        RowBox[{"Typed", "[", 
         RowBox[{"key", ",", 
          
          RowBox[{"\"\<FixedArray\>\"", "::[", "\"\<MachineInteger\>\"", 
           "]"}]}], "]"}]}], "\[IndentingNewLine]", "}"}], ",", 
      "\[IndentingNewLine]", 
      RowBox[{"Flatten", "@", "\[IndentingNewLine]", 
       RowBox[{"Table", "[", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"If", "[", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"MemberQ", "[", 
            RowBox[{"reachable", ",", "j"}], "]"}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Flatten", "@", 
            RowBox[{"Table", "[", 
             RowBox[{
              RowBox[{"key", "[", 
               RowBox[{"[", "k", "]"}], "]"}], ",", 
              RowBox[{"{", 
               RowBox[{"k", ",", 
                RowBox[{
                 RowBox[{"8", "*", "j"}], "-", "7"}], ",", 
                RowBox[{"8", "*", "j"}]}], "}"}]}], "]"}]}], ",", 
           "\[IndentingNewLine]", 
           RowBox[{"Table", "[", 
            RowBox[{"1", ",", "8"}], "]"}]}], "\[IndentingNewLine]", "]"}], ",",
          "\[IndentingNewLine]", 
         RowBox[{"{", 
          RowBox[{"j", ",", "states"}], "}"}]}], "\[IndentingNewLine]", 
        "]"}]}]}], "\[IndentingNewLine]", "]"}], "\[IndentingNewLine]", 
    "]"}]}], ";"}]], "Input",
 CellChangeTimes->{{3.960991454052341*^9, 3.960991460295486*^9}, {
   3.960992982039764*^9, 3.960992999071642*^9}, {3.960993049919018*^9, 
   3.960993073083968*^9}, {3.960993179904516*^9, 3.960993214180182*^9}, {
   3.960993279539331*^9, 3.960993288842741*^9}, {3.960993321096613*^9, 
   3.9609933278030376`*^9}, {3.96099365702754*^9, 3.9609937272446136`*^9}, {
   3.960993767201515*^9, 3.960993785684816*^9}, {3.9609938249682903`*^9, 
   3.960993837203794*^9}, {3.9609938839470453`*^9, 3.960993922434039*^9}, {
   3.9609939669733553`*^9, 3.9609939738059673`*^9}, {3.960994005053473*^9, 
   3.960994063827528*^9}, {3.960994115513442*^9, 3.9609941875408173`*^9}, {
   3.960994310447297*^9, 3.960994313490761*^9}, {3.960994695638929*^9, 
   3.960994761772931*^9}, 3.960994850441481*^9},
 CellLabel->"In[73]:=",ExpressionUUID->"5f9c3d1d-4c31-40b8-84d9-4d79618b5f9d"],

Cell[BoxData[
 RowBox[{
  RowBox[{"prunedo", "[", "len_Integer", "]"}], ":=", "\[IndentingNewLine]", 
  RowBox[{"Module", "[", 
   RowBox[{
    RowBox[{"{", 
     RowBox[{"rcur", ",", "tmp", ",", 
      RowBox[{"cnt", "=", 
       RowBox[{"CreateDataStructure", "[", 
        RowBox[{"\"\<Counter\>\"", ",", "0"}], "]"}]}]}], "}"}], ",", 
    "\[IndentingNewLine]", 
    RowBox[{"Do", "[", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"If", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{
         RowBox[{"cnt", "[", "\"\<Get\>\"", "]"}], ">", "0"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"cnt", "[", "\"\<Decrement\>\"", "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"With", "[", 
         RowBox[{
          RowBox[{"{", 
           RowBox[{"info", "=", 
            RowBox[{"getinfo", "[", 
             RowBox[{"tmRuleFromNum", "[", 
              RowBox[{"i", ",", "states", ",", "symbols"}], "]"}], "]"}]}], 
           "}"}], ",", "\[IndentingNewLine]", 
          RowBox[{
           RowBox[{"rcur", "=", 
            RowBox[{"VertexOutComponent", "[", 
             RowBox[{
              RowBox[{"info", "[", 
               RowBox[{"[", "2", "]"}], "]"}], ",", "1"}], "]"}]}], ";", 
           "\[IndentingNewLine]", 
           RowBox[{"map", "[", "\[IndentingNewLine]", 
            RowBox[{"\"\<Insert\>\"", ",", "\[IndentingNewLine]", 
             RowBox[{
              RowBox[{
               RowBox[{"(", 
                RowBox[{"#", "->", 
                 RowBox[{
                  RowBox[{"map", "[", 
                   RowBox[{"\"\<Lookup\>\"", ",", "#", ",", 
                    RowBox[{"0", "&"}]}], "]"}], "\[IndentingNewLine]", "+", 
                  RowBox[{"If", "[", "\[IndentingNewLine]", 
                   RowBox[{
                    RowBox[{"consQ", "[", 
                    RowBox[{"Sort", "[", "rcur", "]"}], "]"}], ",", 
                    "\[IndentingNewLine]", 
                    RowBox[{
                    RowBox[{"tmp", "=", 
                    RowBox[{"perm", "[", 
                    RowBox[{"Length", "[", "rcur", "]"}], "]"}]}], ";", 
                    RowBox[{"cnt", "[", 
                    RowBox[{"\"\<Set\>\"", ",", 
                    RowBox[{"tmp", "-", "1"}]}], "]"}], ";", "tmp"}], ",", 
                    "\[IndentingNewLine]", "1"}], "\[IndentingNewLine]", 
                   "]"}]}]}], "\[IndentingNewLine]", ")"}], "&"}], "@", 
              RowBox[{"cftransform", "[", 
               RowBox[{"states", ",", "symbols", ",", "rcur", ",", 
                RowBox[{"Flatten", "@", 
                 RowBox[{"info", "[", 
                  RowBox[{"[", "1", "]"}], "]"}]}]}], "]"}]}]}], 
            "\[IndentingNewLine]", "]"}], ";"}]}], "\[IndentingNewLine]", 
         "]"}]}], "\[IndentingNewLine]", "]"}], ",", "\[IndentingNewLine]", 
      RowBox[{"{", 
       RowBox[{"i", ",", "0", ",", 
        RowBox[{"len", "-", "1"}]}], "}"}]}], "\[IndentingNewLine]", "]"}]}], 
   "\[IndentingNewLine]", "]"}]}]], "Input",
 CellChangeTimes->{
  3.960644444625381*^9, {3.960645206650008*^9, 3.960645263136382*^9}, {
   3.9606453492352943`*^9, 3.960645349398921*^9}, {3.960645382581768*^9, 
   3.960645382786523*^9}, {3.9606467826089993`*^9, 3.960646784053727*^9}, {
   3.9606468696547413`*^9, 3.960646870116309*^9}, {3.9606469526377563`*^9, 
   3.960646964831485*^9}, {3.960647030924445*^9, 3.960647204609453*^9}, {
   3.960647283473796*^9, 3.960647291831983*^9}, {3.960647349314056*^9, 
   3.9606473684601316`*^9}, {3.9606474167018957`*^9, 
   3.9606474720526114`*^9}, {3.960647518677609*^9, 3.960647528327667*^9}, {
   3.9606475621765127`*^9, 3.960647563085348*^9}, {3.9606475982571287`*^9, 
   3.960647683321907*^9}, {3.960647731244691*^9, 3.9606477450162897`*^9}, {
   3.960647788508236*^9, 3.960647842570931*^9}, {3.960647998458479*^9, 
   3.960648059602953*^9}, {3.960648118160726*^9, 3.960648148255415*^9}, {
   3.960648210654891*^9, 3.960648244277281*^9}, {3.960649039379752*^9, 
   3.960649066249064*^9}, {3.960675337980174*^9, 3.960675339982596*^9}, {
   3.960675402155993*^9, 3.960675560132691*^9}, {3.960675623079352*^9, 
   3.960675761786447*^9}, {3.9606759166675663`*^9, 3.960675916990776*^9}, {
   3.960675951907674*^9, 3.96067600751709*^9}, {3.960676125252016*^9, 
   3.960676269662652*^9}, {3.960676452410956*^9, 3.960676454523058*^9}, {
   3.960676522661462*^9, 3.960676559899909*^9}, {3.960676593603303*^9, 
   3.960676606248275*^9}, {3.960676644191695*^9, 3.96067666293715*^9}, {
   3.9606771639392147`*^9, 3.960677229313366*^9}, {3.960677265630692*^9, 
   3.960677349075975*^9}, {3.960677542514333*^9, 3.9606775723682404`*^9}, {
   3.9606776175789843`*^9, 3.9606776433184347`*^9}, {3.960677811032053*^9, 
   3.9606778429059772`*^9}, {3.960677884251009*^9, 3.96067788634505*^9}, {
   3.960677924153235*^9, 3.960677934994321*^9}, {3.960678043989975*^9, 
   3.9606780767124243`*^9}, {3.9606782808519773`*^9, 
   3.9606782810842752`*^9}, {3.960687289033272*^9, 3.9606872897075243`*^9}, 
   3.960711925850589*^9, 3.9607120170814257`*^9, {3.9607120619642477`*^9, 
   3.9607120658605433`*^9}, {3.9607123524362507`*^9, 3.96071235949757*^9}, {
   3.9607123983134117`*^9, 3.960712437446419*^9}, {3.9607124776743727`*^9, 
   3.9607124866614523`*^9}, {3.960712546646999*^9, 3.9607125520207453`*^9}, {
   3.960712589291312*^9, 3.96071259145333*^9}, {3.960712639529833*^9, 
   3.960712684124927*^9}, {3.9607127204016*^9, 3.9607127314193707`*^9}, {
   3.960712985402998*^9, 3.960712986908596*^9}, {3.960713232592239*^9, 
   3.960713249526555*^9}, {3.9607133730271273`*^9, 3.960713432709482*^9}, {
   3.960713652620379*^9, 3.960713653095693*^9}, {3.960713958567771*^9, 
   3.960713965974888*^9}, 3.96071811622204*^9, {3.960718297119917*^9, 
   3.96071834225071*^9}, {3.960718920814849*^9, 3.960718924366967*^9}, {
   3.9607190254411163`*^9, 3.9607190307621593`*^9}, {3.9607288834664*^9, 
   3.960728890770743*^9}, {3.9607289332091*^9, 3.960728933720367*^9}, {
   3.9607290984277163`*^9, 3.960729103432185*^9}, {3.9607293892487173`*^9, 
   3.9607294819270144`*^9}, {3.9607295653671093`*^9, 
   3.9607295827588263`*^9}, {3.960729617519512*^9, 3.96072969378384*^9}, {
   3.960729763473969*^9, 3.9607298077584467`*^9}, {3.960729847203027*^9, 
   3.960729921760816*^9}, {3.960730141931978*^9, 3.9607301504778233`*^9}, {
   3.960730228429891*^9, 3.960730347617114*^9}, {3.960753767016509*^9, 
   3.9607537675908747`*^9}, {3.960856607376891*^9, 3.960856612843904*^9}, 
   3.960856679695636*^9, {3.960858304273472*^9, 3.9608583075148687`*^9}, {
   3.960858389902525*^9, 3.96085839001184*^9}, {3.960885075123172*^9, 
   3.960885146666288*^9}, {3.960885177055787*^9, 3.960885185704863*^9}, {
   3.960911758997957*^9, 3.960911777066781*^9}, {3.960935449629936*^9, 
   3.960935449838872*^9}, {3.960935889146974*^9, 3.960935932874078*^9}, {
   3.960936182656398*^9, 3.960936185495573*^9}, {3.960936422672185*^9, 
   3.96093645288621*^9}, {3.960936529725134*^9, 3.960936530421891*^9}, {
   3.960936571115116*^9, 3.960936571565804*^9}, {3.960936698935453*^9, 
   3.960936743129715*^9}, {3.9609369322460213`*^9, 3.960936944396578*^9}, {
   3.960937065522336*^9, 3.96093707881892*^9}, {3.960937536180369*^9, 
   3.960937536777529*^9}, {3.960937917731358*^9, 3.960937990240052*^9}, {
   3.9609386026463413`*^9, 3.960938694420076*^9}, {3.9609388100411587`*^9, 
   3.9609389179917603`*^9}, {3.9609389483689833`*^9, 3.960939062170767*^9}, {
   3.9609391420335484`*^9, 3.960939300479109*^9}, {3.960939447992133*^9, 
   3.9609394570629053`*^9}, {3.960939493928062*^9, 3.96093950435818*^9}, {
   3.9609395827599907`*^9, 3.960939583334573*^9}, {3.960939616841391*^9, 
   3.960939751370597*^9}, {3.9609398003858967`*^9, 3.960939830620037*^9}, {
   3.960939878340558*^9, 3.960939950311227*^9}, {3.960940082241329*^9, 
   3.960940113266924*^9}, {3.960940165595292*^9, 3.960940257503523*^9}, {
   3.9609403170469913`*^9, 3.960940317970972*^9}, {3.960940349083797*^9, 
   3.960940393993515*^9}, {3.96094046606285*^9, 3.9609404773834133`*^9}, {
   3.9609405166405907`*^9, 3.960940516759789*^9}, {3.960940636532765*^9, 
   3.960940696562059*^9}, {3.960940830796254*^9, 3.960940844262445*^9}, {
   3.960940924180299*^9, 3.960941079456436*^9}, {3.960941453239007*^9, 
   3.9609414560349092`*^9}, {3.960941513917226*^9, 3.960941514538436*^9}, {
   3.96094160126083*^9, 3.960941656177577*^9}, {3.960941732835355*^9, 
   3.960941787136866*^9}, 3.960941909472859*^9, {3.960941981489605*^9, 
   3.960941982515141*^9}, {3.960942838606968*^9, 3.960942855346884*^9}, {
   3.96094288742588*^9, 3.960942946013672*^9}, {3.960972785537126*^9, 
   3.960972785968896*^9}, {3.960976387625655*^9, 3.960976423262034*^9}, {
   3.960976462547365*^9, 3.9609764876380777`*^9}, {3.960976582924137*^9, 
   3.960976583294779*^9}, {3.960976710042406*^9, 3.960976761342635*^9}, {
   3.9609767958828163`*^9, 3.960976798115932*^9}, {3.960976871001889*^9, 
   3.960976875233315*^9}, {3.960976951091943*^9, 3.9609769963005543`*^9}, {
   3.9609771310455437`*^9, 3.960977177273425*^9}, {3.9609772423302383`*^9, 
   3.960977400456355*^9}, {3.960977449943668*^9, 3.960977500052806*^9}, {
   3.9609783082361937`*^9, 3.96097840683807*^9}, {3.9609784452966022`*^9, 
   3.960978468345055*^9}, {3.960979847462863*^9, 3.96098002299739*^9}, {
   3.960980064754799*^9, 3.960980092638958*^9}, {3.960980125018725*^9, 
   3.960980150113043*^9}, {3.9609803151130447`*^9, 3.960980325444683*^9}, {
   3.960980361840584*^9, 3.960980365362834*^9}, {3.960980475081057*^9, 
   3.960980479796289*^9}, {3.960980510598813*^9, 3.9609806034183197`*^9}, {
   3.960980640461691*^9, 3.960980642628063*^9}, {3.960980776057949*^9, 
   3.9609807864782677`*^9}, 3.96098090445415*^9, {3.9609844105256433`*^9, 
   3.960984420236166*^9}, 3.960988705598197*^9, {3.960989194514879*^9, 
   3.9609891982074347`*^9}, {3.960989281506977*^9, 3.960989291665104*^9}, 
   3.960994800696631*^9, {3.960994873851303*^9, 3.960994907963975*^9}, {
   3.9609950204555283`*^9, 3.9609950513345747`*^9}, {3.96099518057721*^9, 
   3.9609951979669657`*^9}, {3.96099527056004*^9, 3.960995278345531*^9}, {
   3.960995381315814*^9, 3.960995420956421*^9}, {3.9609955514545307`*^9, 
   3.960995625297043*^9}, {3.9609956663568077`*^9, 3.960995728155478*^9}, {
   3.961002096733756*^9, 3.961002097227002*^9}, {3.961002141286262*^9, 
   3.96100217442421*^9}, {3.961002930911291*^9, 3.961002931506425*^9}, {
   3.961003004283762*^9, 3.9610030474771433`*^9}, 3.961003476998616*^9, {
   3.961004746419506*^9, 3.9610047554032917`*^9}, {3.961004815569006*^9, 
   3.961004819302381*^9}, 3.9610048860979567`*^9, {3.961005816798868*^9, 
   3.961005817936638*^9}, {3.961008961156774*^9, 3.9610089688924427`*^9}, {
   3.9610092563379803`*^9, 3.961009269275141*^9}, {3.9610116316064777`*^9, 
   3.9610116321740923`*^9}, {3.96101213542073*^9, 3.961012163160109*^9}, {
   3.961014034243641*^9, 3.961014046378354*^9}, {3.961057823487214*^9, 
   3.961057826328903*^9}, 3.9610593261309032`*^9, {3.961103987633874*^9, 
   3.961103997534865*^9}, 3.961104028728319*^9, {3.961104121658799*^9, 
   3.961104122403708*^9}, {3.961118841726595*^9, 
   3.96111886610817*^9}},ExpressionUUID->"7e2d4e6b-511f-4784-a00a-\
3d6da715c8ec"]
}, Open  ]]
},
WindowSize->{748, 430},
WindowMargins->{{8, Automatic}, {8, Automatic}},
FrontEndVersion->"14.2 for Mac OS X ARM (64-bit) (March 16, 2025)",
StyleDefinitions->"Default.nb",
ExpressionUUID->"e5e83a41-6523-4ddc-bb73-4f6ec7b411bb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[554, 20, 1142, 29, 213, "Input",ExpressionUUID->"782c6a84-4144-43de-8545-bb1e2ca399a1"],
Cell[1699, 51, 2498, 52, 315, "Input",ExpressionUUID->"141819c5-efcd-4271-96e3-cb5ba28ba90c"],
Cell[4200, 105, 4952, 103, 519, "Input",ExpressionUUID->"44e29823-3957-4523-9c39-615e39118214"],
Cell[9155, 210, 237, 4, 36, "CodeText",ExpressionUUID->"20ed4f37-290d-4dbe-b16c-5196f07af612"],
Cell[9395, 216, 784, 20, 49, "Input",ExpressionUUID->"9a1bf6a4-57df-4ff5-bdcc-88440ac92918"],
Cell[10182, 238, 321, 7, 29, "Input",ExpressionUUID->"73aa3840-b032-406d-ad89-a95f87708b13"],
Cell[CellGroupData[{
Cell[10528, 249, 163, 3, 53, "Subsection",ExpressionUUID->"d24af7cb-9903-45dc-8a3a-5473e59453df"],
Cell[10694, 254, 180, 3, 36, "CodeText",ExpressionUUID->"cb5924c7-d200-4225-a42b-3043f7b3feb1"],
Cell[10877, 259, 385, 9, 29, "Input",ExpressionUUID->"806871b6-330b-4543-8105-7f9806e31941"],
Cell[11265, 270, 2650, 60, 213, "Input",ExpressionUUID->"7899d09b-674f-4e64-a386-c18a41ba101c"],
Cell[13918, 332, 737, 17, 49, "Input",ExpressionUUID->"1f89bb2a-10ff-4b2c-abf4-7374059aa311"],
Cell[14658, 351, 595, 13, 49, "Input",ExpressionUUID->"205f85cf-13ee-4933-86e5-5b2a91f3a602"],
Cell[15256, 366, 550, 14, 49, "Input",ExpressionUUID->"3b144d34-25ab-49d7-b80a-7d60fca8128f"],
Cell[15809, 382, 2790, 59, 376, "Input",ExpressionUUID->"5f9c3d1d-4c31-40b8-84d9-4d79618b5f9d"],
Cell[18602, 443, 11206, 182, 478, "Input",ExpressionUUID->"7e2d4e6b-511f-4784-a00a-3d6da715c8ec"]
}, Open  ]]
}
]
*)

